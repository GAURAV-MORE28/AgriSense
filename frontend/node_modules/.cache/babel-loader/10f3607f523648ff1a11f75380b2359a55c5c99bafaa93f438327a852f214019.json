{"ast":null,"code":"/**\r\n * Application Form â€“ Review and submit application for a scheme\r\n */import React,{useState,useEffect}from'react';import{useParams,useNavigate}from'react-router-dom';import{useTranslation}from'react-i18next';import axios from'axios';import{useAuth}from'../contexts/AuthContext';import LoadingSpinner from'../components/LoadingSpinner';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_URL=process.env.REACT_APP_API_URL||'http://localhost:4000/api/v1';const ApplicationForm=()=>{const{schemeId}=useParams();const{t}=useTranslation();const navigate=useNavigate();const{token,isAuthenticated,profile}=useAuth();const[schemeName,setSchemeName]=useState('');const[loading,setLoading]=useState(true);const[submitting,setSubmitting]=useState(false);const[error,setError]=useState(null);const[success,setSuccess]=useState(null);const[requiredDocs,setRequiredDocs]=useState([]);const[userDocuments,setUserDocuments]=useState([]);const[selectedDocIds,setSelectedDocIds]=useState([]);// Auth check\nuseEffect(()=>{if(!isAuthenticated){navigate('/login');return;}if(!profile){navigate('/profile');return;}},[isAuthenticated,profile,navigate]);// Load scheme details and user documents\nuseEffect(()=>{const load=async()=>{setLoading(true);try{if(schemeId){const[schemeRes,docsRes]=await Promise.all([axios.get(\"\".concat(API_URL,\"/schemes/\").concat(schemeId)).catch(()=>({data:{}})),axios.get(\"\".concat(API_URL,\"/documents\"),{headers:{Authorization:\"Bearer \".concat(token)}}).catch(()=>({data:{documents:[]}}))]);setSchemeName(schemeRes.data.name||(schemeId===null||schemeId===void 0?void 0:schemeId.replace(/-/g,' '))||'Government Scheme');setRequiredDocs(schemeRes.data.required_documents||schemeRes.data.documents_required||['Aadhaar Card','Land Records','Bank Passbook']);setUserDocuments(docsRes.data.documents||[]);}}catch(e){setSchemeName((schemeId===null||schemeId===void 0?void 0:schemeId.replace(/-/g,' '))||'Government Scheme');setRequiredDocs(['Aadhaar Card','Land Records','Bank Passbook']);}finally{setLoading(false);}};if(token)load();},[schemeId,token]);const toggleDocSelection=docId=>{setSelectedDocIds(prev=>prev.includes(docId)?prev.filter(id=>id!==docId):[...prev,docId]);};const handleSubmit=async()=>{if(!(profile!==null&&profile!==void 0&&profile.profile_id)){setError('Profile ID missing. Please update your profile first.');return;}setSubmitting(true);setError(null);try{const payload={profile_id:profile.profile_id,scheme_id:schemeId,scheme_name:schemeName,documents:selectedDocIds,form_data:{name:profile.name,state:profile.state,district:profile.district,farmer_type:profile.farmer_type,notes:'Applied via KRISHI-AI Portal'},client_timestamp:new Date().toISOString()};const res=await axios.post(\"\".concat(API_URL,\"/application/submit\"),payload,{headers:{Authorization:\"Bearer \".concat(token)}});setSuccess({id:res.data.application_id,govId:res.data.gov_application_id});}catch(err){var _err$response,_err$response$data;console.error('Submission failed',err);setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.error)||'Submission failed. Please try again.');}finally{setSubmitting(false);}};if(loading)return/*#__PURE__*/_jsx(LoadingSpinner,{});if(success){return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-2xl mx-auto px-4 py-16 text-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-3xl shadow-xl p-10 border border-gray-100\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-20 h-20 mx-auto bg-green-100 rounded-full flex items-center justify-center text-4xl mb-6\",children:\"\\uD83C\\uDF89\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 mb-2\",children:\"Application Submitted!\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-6\",children:\"Your application has been received and is being processed.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 rounded-xl p-4 mb-6 text-left\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Application ID\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-mono font-bold text-gray-900\",children:success.id})]}),success.govId&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm mt-3\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Govt Reference\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-mono font-bold text-green-700\",children:success.govId})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(\"/status/\".concat(success.id)),className:\"flex-1 btn-primary\",children:\"Track Status \\u2192\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/schemes'),className:\"flex-1 btn-secondary\",children:\"Apply More\"})]})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-2xl mx-auto px-4 py-8\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold mb-6\",children:t('application.title')||'Application Form'}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 mb-4 text-red-700 bg-red-50 rounded-xl border border-red-200 text-sm flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u26A0\\uFE0F\"}),\" \",error]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-6 bg-gradient-to-r from-green-50 to-emerald-50 border-b border-green-100\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-green-600 font-semibold uppercase mb-1\",children:\"Applying for\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-green-800\",children:schemeName})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6 pb-6 border-b\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-bold text-gray-700 uppercase mb-3\",children:\"Applicant Details\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400\",children:\"Name\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-semibold\",children:profile===null||profile===void 0?void 0:profile.name})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400\",children:\"Mobile\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-semibold\",children:profile===null||profile===void 0?void 0:profile.mobile})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400\",children:\"State / District\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-semibold\",children:[profile===null||profile===void 0?void 0:profile.state,\", \",profile===null||profile===void 0?void 0:profile.district]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400\",children:\"Farmer Type\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-semibold capitalize\",children:profile===null||profile===void 0?void 0:profile.farmer_type})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-bold text-gray-700 uppercase mb-3\",children:\"Attach Documents\"}),userDocuments.length>0?/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500 mb-2\",children:\"Select documents to attach to this application:\"}),userDocuments.map(doc=>/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center gap-3 p-3 rounded-xl border border-gray-200 hover:border-green-300 cursor-pointer transition-colors\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:selectedDocIds.includes(doc.document_id),onChange:()=>toggleDocSelection(doc.document_id),className:\"rounded border-gray-300 text-[#1E8E4A] focus:ring-[#1E8E4A]\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-700\",children:doc.filename}),doc.doc_type&&/*#__PURE__*/_jsxs(\"span\",{className:\"text-xs text-gray-500\",children:[\"(\",doc.doc_type,\")\"]})]},doc.document_id)),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mt-2\",children:/*#__PURE__*/_jsx(\"a\",{href:\"/documents\",className:\"text-[#1E8E4A] hover:underline\",children:\"Upload more documents\"})})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-amber-50 border border-amber-200 rounded-xl\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-amber-800 mb-2\",children:\"No documents uploaded yet.\"}),/*#__PURE__*/_jsx(\"a\",{href:\"/documents\",className:\"text-[#1E8E4A] font-semibold hover:underline\",children:\"Upload documents first \\u2192\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-amber-600 mt-2\",children:\"You can still submit; add documents later if required.\"})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSubmit,disabled:submitting,className:\"w-full py-3.5 bg-gradient-to-r from-green-600 to-emerald-600 text-white font-bold text-lg rounded-xl shadow-lg shadow-green-500/25 hover:shadow-xl disabled:opacity-50 transition-all duration-300 hover:-translate-y-0.5 disabled:hover:translate-y-0\",children:submitting?/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center justify-center gap-2\",children:[/*#__PURE__*/_jsxs(\"svg\",{className:\"animate-spin h-5 w-5\",viewBox:\"0 0 24 24\",children:[/*#__PURE__*/_jsx(\"circle\",{className:\"opacity-25\",cx:\"12\",cy:\"12\",r:\"10\",stroke:\"currentColor\",strokeWidth:\"4\",fill:\"none\"}),/*#__PURE__*/_jsx(\"path\",{className:\"opacity-75\",fill:\"currentColor\",d:\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z\"})]}),\"Submitting...\"]}):'Submit Application ðŸš€'})]})]})]});};export default ApplicationForm;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}