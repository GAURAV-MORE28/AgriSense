{"ast":null,"code":"/**\r\n * Scheme Results Page – AI-matched schemes with explainability\r\n */import React,{useEffect,useState}from'react';import{useNavigate}from'react-router-dom';import{useTranslation}from'react-i18next';import{useAuth}from'../contexts/AuthContext';import LoadingSpinner from'../components/LoadingSpinner';import SchemeCard from'../components/SchemeCard';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_URL=process.env.REACT_APP_API_URL||'http://localhost:4001/api/v1';const SchemeResults=()=>{const{t,i18n}=useTranslation();const navigate=useNavigate();const{token,isAuthenticated,hasProfile,profile}=useAuth();const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[schemes,setSchemes]=useState([]);const[expandedId,setExpandedId]=useState(null);const[evaluatedCount,setEvaluatedCount]=useState(0);const[processingTime,setProcessingTime]=useState(0);const[filter,setFilter]=useState('all');useEffect(()=>{if(!isAuthenticated){navigate('/login');return;}if(!hasProfile){navigate('/profile');return;}const fetchSchemes=async()=>{try{// Use the authenticated GET /schemes endpoint (fetches profile from DB)\nconst response=await fetch(\"\".concat(API_URL,\"/schemes?top_k=20\"),{headers:{Authorization:\"Bearer \".concat(token)}});if(!response.ok){throw new Error(\"HTTP \".concat(response.status));}const data=await response.json();setSchemes(data.recommendations||[]);setEvaluatedCount(data.total_schemes_evaluated||0);setProcessingTime(data.processing_time_ms||0);}catch(err){console.error('Error fetching schemes:',err);setError('Could not fetch recommendations. Showing demo data.');setSchemes(getDemoSchemes());setEvaluatedCount(20);}finally{setLoading(false);}};fetchSchemes();},[token,isAuthenticated,hasProfile,navigate]);const getLocalizedName=scheme=>{if(i18n.language==='hi'&&scheme.name_hi)return scheme.name_hi;if(i18n.language==='mr'&&scheme.name_mr)return scheme.name_mr;return scheme.name;};const getLocalizedExplanation=scheme=>{if(i18n.language==='hi'&&scheme.textual_explanation_hi)return scheme.textual_explanation_hi;if(i18n.language==='mr'&&scheme.textual_explanation_mr)return scheme.textual_explanation_mr;return scheme.textual_explanation;};const filteredSchemes=schemes.filter(s=>{if(filter==='eligible')return s.eligibility_status==='eligible';if(filter==='partial')return s.eligibility_status==='partially_eligible';return true;});const eligibleCount=schemes.filter(s=>s.eligibility_status==='eligible').length;const partialCount=schemes.filter(s=>s.eligibility_status==='partially_eligible').length;if(loading){return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-[60vh] flex flex-col items-center justify-center\",children:[/*#__PURE__*/_jsx(LoadingSpinner,{}),/*#__PURE__*/_jsxs(\"p\",{className:\"mt-4 text-gray-500 animate-pulse\",children:[\"Running AI matching against \",evaluatedCount||'20+',\" schemes...\"]})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-4xl mx-auto px-4 py-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsxs(\"h1\",{className:\"text-2xl font-bold text-gray-900 mb-1\",children:[\"\\uD83C\\uDFAF \",t('schemes.title')||'Your Matched Schemes']}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-500 text-sm\",children:[\"AI evaluated \",evaluatedCount,\" schemes for \",(profile===null||profile===void 0?void 0:profile.name)||'you',processingTime>0&&/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-400\",children:[\" \\u2022 \",processingTime,\"ms\"]})]})]}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-amber-50 border border-amber-200 rounded-xl p-4 mb-6 text-sm text-amber-800\",children:[\"\\u26A0\\uFE0F \",error]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-3 gap-3 mb-6\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setFilter('all'),className:\"p-3 rounded-xl border-2 text-center transition-all \".concat(filter==='all'?'border-green-500 bg-green-50':'border-gray-100 bg-white hover:border-gray-200'),children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-gray-900\",children:schemes.length}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"Total Found\"})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setFilter('eligible'),className:\"p-3 rounded-xl border-2 text-center transition-all \".concat(filter==='eligible'?'border-green-500 bg-green-50':'border-gray-100 bg-white hover:border-gray-200'),children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-green-600\",children:eligibleCount}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"Fully Eligible\"})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setFilter('partial'),className:\"p-3 rounded-xl border-2 text-center transition-all \".concat(filter==='partial'?'border-green-500 bg-green-50':'border-gray-100 bg-white hover:border-gray-200'),children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-amber-600\",children:partialCount}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"Partially Eligible\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid gap-4\",children:filteredSchemes.map((scheme,index)=>/*#__PURE__*/_jsx(SchemeCard,{scheme:scheme,rank:filter==='all'?index+1:undefined,isExpanded:expandedId===scheme.scheme_id,onToggle:()=>setExpandedId(expandedId===scheme.scheme_id?null:scheme.scheme_id),localizedName:getLocalizedName(scheme),localizedExplanation:getLocalizedExplanation(scheme)},scheme.scheme_id))}),filteredSchemes.length===0&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-12 text-gray-400\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-4xl mb-3\",children:\"\\uD83D\\uDD0D\"}),/*#__PURE__*/_jsx(\"p\",{children:\"No schemes match this filter. Try \\\"Total Found\\\" view.\"})]})]});};// Demo data for offline/fallback\nfunction getDemoSchemes(){return[{scheme_id:'PM-KISAN-001',name:'PM-KISAN Samman Nidhi',name_hi:'पीएम-किसान सम्मान निधि',name_mr:'पीएम-किसान सन्मान निधी',score:95,benefit_estimate:6000,confidence:'high',eligibility_status:'eligible',textual_explanation:'You are fully eligible for PM-KISAN. You could receive up to ₹6,000 annually.',textual_explanation_hi:'आप पीएम-किसान के लिए पूर्ण रूप से पात्र हैं।',textual_explanation_mr:'तुम्ही पीएम-किसान साठी पूर्णपणे पात्र आहात.',matched_rules:[{description:'Land holding ≤ 2 hectares'},{description:'Owner or tenant farmer'}],failing_rules:[],expected_documents:['Aadhaar Card','Land Records','Bank Passbook']},{scheme_id:'PMFBY-003',name:'PM Fasal Bima Yojana',name_hi:'प्रधानमंत्री फसल बीमा योजना',name_mr:'प्रधानमंत्री पीक विमा योजना',score:88,benefit_estimate:60000,confidence:'high',eligibility_status:'eligible',textual_explanation:'You are eligible for crop insurance coverage based on your crops and land.',matched_rules:[{description:'Has cultivable land'},{description:'Grows notified crops'}],failing_rules:[],expected_documents:['Aadhaar Card','Land Records','Sowing Certificate']},{scheme_id:'KCC-004',name:'Kisan Credit Card',name_hi:'किसान क्रेडिट कार्ड',name_mr:'किसान क्रेडिट कार्ड',score:82,benefit_estimate:150000,confidence:'medium',eligibility_status:'eligible',textual_explanation:'You can get credit at subsidized interest rates for farm operations.',matched_rules:[{description:'Owner or tenant farmer'}],failing_rules:[],expected_documents:['Aadhaar Card','Land Records','Bank Account']}];}export default SchemeResults;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}