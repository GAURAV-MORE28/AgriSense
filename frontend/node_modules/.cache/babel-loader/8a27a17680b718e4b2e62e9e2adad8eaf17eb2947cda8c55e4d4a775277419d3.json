{"ast":null,"code":"/**\r\n * Offline Context - Manages offline state and sync queue\r\n */import React,{createContext,useContext,useState,useEffect}from'react';import{openDB}from'idb';import{jsx as _jsx}from\"react/jsx-runtime\";const OfflineContext=/*#__PURE__*/createContext(undefined);let db=null;async function getDB(){if(db)return db;db=await openDB('krishi-ai-db',1,{upgrade(database){if(!database.objectStoreNames.contains('profiles')){database.createObjectStore('profiles',{keyPath:'id'});}if(!database.objectStoreNames.contains('applications')){database.createObjectStore('applications',{keyPath:'id'});}if(!database.objectStoreNames.contains('syncQueue')){database.createObjectStore('syncQueue',{keyPath:'id'});}}});return db;}export const OfflineProvider=_ref=>{let{children}=_ref;const[isOffline,setIsOffline]=useState(!navigator.onLine);const[queuedCount,setQueuedCount]=useState(0);useEffect(()=>{const handleOnline=()=>setIsOffline(false);const handleOffline=()=>setIsOffline(true);window.addEventListener('online',handleOnline);window.addEventListener('offline',handleOffline);// Update queued count\nupdateQueuedCount();return()=>{window.removeEventListener('online',handleOnline);window.removeEventListener('offline',handleOffline);};},[]);const updateQueuedCount=async()=>{try{const database=await getDB();const count=await database.count('syncQueue');setQueuedCount(count);}catch(e){console.error('Failed to get queue count');}};const saveProfile=async(id,data)=>{const database=await getDB();await database.put('profiles',{id,data,synced:!isOffline,updatedAt:new Date().toISOString()});if(isOffline){await database.put('syncQueue',{id:\"profile-\".concat(id,\"-\").concat(Date.now()),type:'profile',operation:'update',data,createdAt:new Date().toISOString()});updateQueuedCount();}};const saveApplication=async(id,data)=>{const database=await getDB();await database.put('applications',{id,data,synced:!isOffline,createdAt:new Date().toISOString()});if(isOffline){await database.put('syncQueue',{id:\"app-\".concat(id,\"-\").concat(Date.now()),type:'application',operation:'create',data,createdAt:new Date().toISOString()});updateQueuedCount();}};const getProfile=async id=>{const database=await getDB();const result=await database.get('profiles',id);return(result===null||result===void 0?void 0:result.data)||null;};const syncPending=async()=>{if(isOffline)return;const database=await getDB();const queue=await database.getAll('syncQueue');for(const item of queue){try{// In production, send to server\nconsole.log('Syncing:',item);await database.delete('syncQueue',item.id);}catch(error){console.error('Sync failed for item:',item.id,error);}}updateQueuedCount();};// Auto-sync when coming back online\nuseEffect(()=>{if(!isOffline){syncPending();}},[isOffline]);return/*#__PURE__*/_jsx(OfflineContext.Provider,{value:{isOffline,queuedCount,saveProfile,saveApplication,getProfile,syncPending},children:children});};export const useOffline=()=>{const context=useContext(OfflineContext);if(context===undefined){throw new Error('useOffline must be used within an OfflineProvider');}return context;};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","openDB","jsx","_jsx","OfflineContext","undefined","db","getDB","upgrade","database","objectStoreNames","contains","createObjectStore","keyPath","OfflineProvider","_ref","children","isOffline","setIsOffline","navigator","onLine","queuedCount","setQueuedCount","handleOnline","handleOffline","window","addEventListener","updateQueuedCount","removeEventListener","count","e","console","error","saveProfile","id","data","put","synced","updatedAt","Date","toISOString","concat","now","type","operation","createdAt","saveApplication","getProfile","result","get","syncPending","queue","getAll","item","log","delete","Provider","value","useOffline","context","Error"],"sources":["C:/Users/gmore/OneDrive/Desktop/Gaurav/krishi-ai/frontend/src/contexts/OfflineContext.tsx"],"sourcesContent":["/**\r\n * Offline Context - Manages offline state and sync queue\r\n */\r\n\r\nimport React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\r\nimport { openDB, DBSchema, IDBPDatabase } from 'idb';\r\n\r\ninterface KrishiDB extends DBSchema {\r\n  profiles: {\r\n    key: string;\r\n    value: {\r\n      id: string;\r\n      data: unknown;\r\n      synced: boolean;\r\n      updatedAt: string;\r\n    };\r\n  };\r\n  applications: {\r\n    key: string;\r\n    value: {\r\n      id: string;\r\n      data: unknown;\r\n      synced: boolean;\r\n      createdAt: string;\r\n    };\r\n  };\r\n  syncQueue: {\r\n    key: string;\r\n    value: {\r\n      id: string;\r\n      type: 'profile' | 'application';\r\n      operation: 'create' | 'update';\r\n      data: unknown;\r\n      createdAt: string;\r\n    };\r\n  };\r\n}\r\n\r\ninterface OfflineContextType {\r\n  isOffline: boolean;\r\n  queuedCount: number;\r\n  saveProfile: (id: string, data: unknown) => Promise<void>;\r\n  saveApplication: (id: string, data: unknown) => Promise<void>;\r\n  getProfile: (id: string) => Promise<unknown | null>;\r\n  syncPending: () => Promise<void>;\r\n}\r\n\r\nconst OfflineContext = createContext<OfflineContextType | undefined>(undefined);\r\n\r\nlet db: IDBPDatabase<KrishiDB> | null = null;\r\n\r\nasync function getDB(): Promise<IDBPDatabase<KrishiDB>> {\r\n  if (db) return db;\r\n\r\n  db = await openDB<KrishiDB>('krishi-ai-db', 1, {\r\n    upgrade(database) {\r\n      if (!database.objectStoreNames.contains('profiles')) {\r\n        database.createObjectStore('profiles', { keyPath: 'id' });\r\n      }\r\n      if (!database.objectStoreNames.contains('applications')) {\r\n        database.createObjectStore('applications', { keyPath: 'id' });\r\n      }\r\n      if (!database.objectStoreNames.contains('syncQueue')) {\r\n        database.createObjectStore('syncQueue', { keyPath: 'id' });\r\n      }\r\n    }\r\n  });\r\n\r\n  return db;\r\n}\r\n\r\nexport const OfflineProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\r\n  const [isOffline, setIsOffline] = useState(!navigator.onLine);\r\n  const [queuedCount, setQueuedCount] = useState(0);\r\n\r\n  useEffect(() => {\r\n    const handleOnline = () => setIsOffline(false);\r\n    const handleOffline = () => setIsOffline(true);\r\n\r\n    window.addEventListener('online', handleOnline);\r\n    window.addEventListener('offline', handleOffline);\r\n\r\n    // Update queued count\r\n    updateQueuedCount();\r\n\r\n    return () => {\r\n      window.removeEventListener('online', handleOnline);\r\n      window.removeEventListener('offline', handleOffline);\r\n    };\r\n  }, []);\r\n\r\n  const updateQueuedCount = async () => {\r\n    try {\r\n      const database = await getDB();\r\n      const count = await database.count('syncQueue');\r\n      setQueuedCount(count);\r\n    } catch (e) {\r\n      console.error('Failed to get queue count');\r\n    }\r\n  };\r\n\r\n  const saveProfile = async (id: string, data: unknown) => {\r\n    const database = await getDB();\r\n    await database.put('profiles', {\r\n      id,\r\n      data,\r\n      synced: !isOffline,\r\n      updatedAt: new Date().toISOString()\r\n    });\r\n\r\n    if (isOffline) {\r\n      await database.put('syncQueue', {\r\n        id: `profile-${id}-${Date.now()}`,\r\n        type: 'profile',\r\n        operation: 'update',\r\n        data,\r\n        createdAt: new Date().toISOString()\r\n      });\r\n      updateQueuedCount();\r\n    }\r\n  };\r\n\r\n  const saveApplication = async (id: string, data: unknown) => {\r\n    const database = await getDB();\r\n    await database.put('applications', {\r\n      id,\r\n      data,\r\n      synced: !isOffline,\r\n      createdAt: new Date().toISOString()\r\n    });\r\n\r\n    if (isOffline) {\r\n      await database.put('syncQueue', {\r\n        id: `app-${id}-${Date.now()}`,\r\n        type: 'application',\r\n        operation: 'create',\r\n        data,\r\n        createdAt: new Date().toISOString()\r\n      });\r\n      updateQueuedCount();\r\n    }\r\n  };\r\n\r\n  const getProfile = async (id: string): Promise<unknown | null> => {\r\n    const database = await getDB();\r\n    const result = await database.get('profiles', id);\r\n    return result?.data || null;\r\n  };\r\n\r\n  const syncPending = async () => {\r\n    if (isOffline) return;\r\n\r\n    const database = await getDB();\r\n    const queue = await database.getAll('syncQueue');\r\n\r\n    for (const item of queue) {\r\n      try {\r\n        // In production, send to server\r\n        console.log('Syncing:', item);\r\n        await database.delete('syncQueue', item.id);\r\n      } catch (error) {\r\n        console.error('Sync failed for item:', item.id, error);\r\n      }\r\n    }\r\n\r\n    updateQueuedCount();\r\n  };\r\n\r\n  // Auto-sync when coming back online\r\n  useEffect(() => {\r\n    if (!isOffline) {\r\n      syncPending();\r\n    }\r\n  }, [isOffline]);\r\n\r\n  return (\r\n    <OfflineContext.Provider value={{\r\n      isOffline,\r\n      queuedCount,\r\n      saveProfile,\r\n      saveApplication,\r\n      getProfile,\r\n      syncPending\r\n    }}>\r\n      {children}\r\n    </OfflineContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useOffline = () => {\r\n  const context = useContext(OfflineContext);\r\n  if (context === undefined) {\r\n    throw new Error('useOffline must be used within an OfflineProvider');\r\n  }\r\n  return context;\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}