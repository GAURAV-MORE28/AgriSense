{"ast":null,"code":"/**\r\n * Floating AI Farmer Chatbot\r\n * Multilingual support with voice input (Web Speech API)\r\n * Welcome message, suggestion chips, and typing animation\r\n */import React,{useState,useRef,useEffect,useCallback}from'react';import{useTranslation}from'react-i18next';import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const API_URL=process.env.REACT_APP_API_URL||'http://localhost:4000/api/v1';const LANGUAGES=[{code:'en',label:'English'},{code:'hi',label:'à¤¹à¤¿à¤‚à¤¦à¥€'},{code:'mr',label:'à¤®à¤°à¤¾à¤ à¥€'}];const WELCOME_MESSAGES={en:{text:\"Namaste! ðŸ™ I'm your Krishi-AI assistant. I help farmers discover government schemes, understand eligibility, and apply easily. How can I help you today?\",suggestions:['Find schemes for me','What is PM-KISAN?','How to apply?','What documents do I need?']},hi:{text:\"à¤¨à¤®à¤¸à¥à¤¤à¥‡! ðŸ™ à¤®à¥ˆà¤‚ à¤†à¤ªà¤•à¤¾ à¤•à¥ƒà¤·à¤¿-AI à¤¸à¤¹à¤¾à¤¯à¤• à¤¹à¥‚à¤‚à¥¤ à¤®à¥ˆà¤‚ à¤•à¤¿à¤¸à¤¾à¤¨à¥‹à¤‚ à¤•à¥‹ à¤¸à¤°à¤•à¤¾à¤°à¥€ à¤¯à¥‹à¤œà¤¨à¤¾à¤à¤‚ à¤–à¥‹à¤œà¤¨à¥‡, à¤ªà¤¾à¤¤à¥à¤°à¤¤à¤¾ à¤¸à¤®à¤à¤¨à¥‡ à¤”à¤° à¤†à¤¸à¤¾à¤¨à¥€ à¤¸à¥‡ à¤†à¤µà¥‡à¤¦à¤¨ à¤•à¤°à¤¨à¥‡ à¤®à¥‡à¤‚ à¤®à¤¦à¤¦ à¤•à¤°à¤¤à¤¾ à¤¹à¥‚à¤‚à¥¤ à¤†à¤œ à¤®à¥ˆà¤‚ à¤†à¤ªà¤•à¥€ à¤•à¥ˆà¤¸à¥‡ à¤®à¤¦à¤¦ à¤•à¤° à¤¸à¤•à¤¤à¤¾ à¤¹à¥‚à¤‚?\",suggestions:['à¤¯à¥‹à¤œà¤¨à¤¾à¤à¤‚ à¤–à¥‹à¤œà¥‡à¤‚','à¤ªà¥€à¤à¤®-à¤•à¤¿à¤¸à¤¾à¤¨ à¤•à¥à¤¯à¤¾ à¤¹à¥ˆ?','à¤†à¤µà¥‡à¤¦à¤¨ à¤•à¥ˆà¤¸à¥‡ à¤•à¤°à¥‡à¤‚?','à¤¦à¤¸à¥à¤¤à¤¾à¤µà¥‡à¤œ à¤•à¥Œà¤¨ à¤¸à¥‡ à¤šà¤¾à¤¹à¤¿à¤?']},mr:{text:\"à¤¨à¤®à¤¸à¥à¤•à¤¾à¤°! ðŸ™ à¤®à¥€ à¤¤à¥à¤®à¤šà¤¾ à¤•à¥ƒà¤·à¥€-AI à¤¸à¤¹à¤¾à¤¯à¥à¤¯à¤• à¤†à¤¹à¥‡. à¤®à¥€ à¤¶à¥‡à¤¤à¤•à¤±à¥à¤¯à¤¾à¤‚à¤¨à¤¾ à¤¸à¤°à¤•à¤¾à¤°à¥€ à¤¯à¥‹à¤œà¤¨à¤¾ à¤¶à¥‹à¤§à¤£à¥à¤¯à¤¾à¤¤, à¤ªà¤¾à¤¤à¥à¤°à¤¤à¤¾ à¤¸à¤®à¤œà¥‚à¤¨ à¤˜à¥‡à¤£à¥à¤¯à¤¾à¤¤ à¤†à¤£à¤¿ à¤¸à¤¹à¤œ à¤…à¤°à¥à¤œ à¤•à¤°à¤£à¥à¤¯à¤¾à¤¤ à¤®à¤¦à¤¤ à¤•à¤°à¤¤à¥‹. à¤†à¤œ à¤®à¥€ à¤¤à¥à¤®à¤šà¥€ à¤•à¤¶à¥€ à¤®à¤¦à¤¤ à¤•à¤°à¥‚ à¤¶à¤•à¤¤à¥‹?\",suggestions:['à¤¯à¥‹à¤œà¤¨à¤¾ à¤¶à¥‹à¤§à¤¾','à¤ªà¥€à¤à¤®-à¤•à¤¿à¤¸à¤¾à¤¨ à¤•à¤¾à¤¯ à¤†à¤¹à¥‡?','à¤…à¤°à¥à¤œ à¤•à¤¸à¤¾ à¤•à¤°à¤¾à¤¯à¤šà¤¾?','à¤•à¤¾à¤—à¤¦à¤ªà¤¤à¥à¤°à¥‡ à¤•à¥‹à¤£à¤¤à¥€?']}};const Chatbot=_ref=>{var _i18n$language;let{token}=_ref;const{i18n}=useTranslation();const[isOpen,setIsOpen]=useState(false);const[messages,setMessages]=useState([]);const[input,setInput]=useState('');const[loading,setLoading]=useState(false);const[language,setLanguage]=useState(((_i18n$language=i18n.language)===null||_i18n$language===void 0?void 0:_i18n$language.split('-')[0])||'en');const[listening,setListening]=useState(false);const[hasOpened,setHasOpened]=useState(false);const messagesEndRef=useRef(null);const recognitionRef=useRef(null);const scrollToBottom=()=>{var _messagesEndRef$curre;return(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});};useEffect(scrollToBottom,[messages]);// Add welcome message on first open\nuseEffect(()=>{if(isOpen&&!hasOpened){setHasOpened(true);const lang=language in WELCOME_MESSAGES?language:'en';const welcome=WELCOME_MESSAGES[lang];setMessages([{id:'welcome',role:'assistant',content:welcome.text,timestamp:new Date(),suggestions:welcome.suggestions}]);}},[isOpen,hasOpened,language]);// Initialize Web Speech API for voice input\nuseEffect(()=>{const SpeechRecognitionAPI=window.SpeechRecognition||window.webkitSpeechRecognition;if(SpeechRecognitionAPI){recognitionRef.current=new SpeechRecognitionAPI();recognitionRef.current.continuous=false;recognitionRef.current.interimResults=false;recognitionRef.current.lang=language==='hi'?'hi-IN':language==='mr'?'mr-IN':'en-IN';recognitionRef.current.onresult=e=>{const transcript=e.results[0][0].transcript;setInput(prev=>prev?\"\".concat(prev,\" \").concat(transcript):transcript);};recognitionRef.current.onend=()=>setListening(false);recognitionRef.current.onerror=()=>setListening(false);}return()=>{if(recognitionRef.current)recognitionRef.current.abort();};},[language]);const toggleVoice=()=>{if(!recognitionRef.current)return;if(listening){recognitionRef.current.stop();}else{recognitionRef.current.lang=language==='hi'?'hi-IN':language==='mr'?'mr-IN':'en-IN';recognitionRef.current.start();setListening(true);}};const sendMessage=useCallback(async messageText=>{const trimmed=(messageText||input).trim();if(!trimmed||loading)return;const userMsg={id:\"u-\".concat(Date.now()),role:'user',content:trimmed,timestamp:new Date()};setMessages(prev=>[...prev,userMsg]);setInput('');setLoading(true);try{const headers={'Content-Type':'application/json'};if(token)headers['Authorization']=\"Bearer \".concat(token);const res=await fetch(\"\".concat(API_URL,\"/ai/chat\"),{method:'POST',headers,body:JSON.stringify({message:trimmed,language})});const data=await res.json();const responseText=data.response||'I could not process that. Please try again.';const suggestions=data.suggestions||[];const botMsg={id:\"b-\".concat(Date.now()),role:'assistant',content:responseText,timestamp:new Date(),suggestions};setMessages(prev=>[...prev,botMsg]);}catch(err){const errMsg={id:\"b-\".concat(Date.now()),role:'assistant',content:'Sorry, I am offline. Please check your connection and try again.',timestamp:new Date()};setMessages(prev=>[...prev,errMsg]);}finally{setLoading(false);}},[input,loading,token,language]);const handleKeyDown=e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage();}};const handleSuggestionClick=suggestion=>{sendMessage(suggestion);};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setIsOpen(!isOpen),className:\"fixed bottom-6 right-6 z-50 w-14 h-14 rounded-full bg-[#1E8E4A] text-white shadow-lg hover:bg-[#176B39] focus:outline-none focus:ring-4 focus:ring-[#1E8E4A]/40 transition-all duration-300 hover:scale-110 flex items-center justify-center\",\"aria-label\":isOpen?'Close chatbot':'Open AI assistant',children:isOpen?/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",\"aria-hidden\":\"true\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M6 18L18 6M6 6l12 12\"})}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",\"aria-hidden\":\"true\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\"})}),!hasOpened&&/*#__PURE__*/_jsx(\"span\",{className:\"absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full border-2 border-white animate-pulse\"})]})}),isOpen&&/*#__PURE__*/_jsxs(\"div\",{className:\"fixed bottom-24 right-6 z-40 w-full max-w-md bg-white rounded-2xl shadow-2xl border border-gray-200 overflow-hidden flex flex-col animate-slide-up\",style:{height:'min(520px, 75vh)'},role:\"dialog\",\"aria-label\":\"AI Farmer Assistant chat\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-r from-[#1E8E4A] to-[#176B39] text-white px-4 py-3 flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 bg-white/20 rounded-full flex items-center justify-center text-sm\",children:\"\\uD83C\\uDF3E\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-base font-semibold\",children:\"Krishi AI Assistant\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"w-1.5 h-1.5 bg-green-300 rounded-full animate-pulse\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-green-200\",children:\"Online\"})]})]})]}),/*#__PURE__*/_jsx(\"select\",{value:language,onChange:e=>setLanguage(e.target.value),className:\"bg-white/20 border border-white/30 rounded-lg px-2 py-1 text-sm text-white focus:outline-none focus:ring-2 focus:ring-white/50\",\"aria-label\":\"Select language\",children:LANGUAGES.map(l=>/*#__PURE__*/_jsx(\"option\",{value:l.code,className:\"text-gray-800\",children:l.label},l.code))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 overflow-y-auto p-4 space-y-3 bg-[#F7FAFC]\",children:[messages.map(m=>/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex \".concat(m.role==='user'?'justify-end':'justify-start',\" animate-fade-in\"),children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-[85%] px-4 py-2.5 rounded-2xl text-sm whitespace-pre-line \".concat(m.role==='user'?'bg-[#1E8E4A] text-white rounded-br-md':'bg-white text-[#1F2937] border border-gray-200 rounded-bl-md shadow-sm'),children:m.content})}),m.role==='assistant'&&m.suggestions&&m.suggestions.length>0&&!loading&&/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-wrap gap-1.5 mt-2 ml-1 animate-fade-in\",children:m.suggestions.map((suggestion,idx)=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleSuggestionClick(suggestion),className:\"px-3 py-1.5 bg-green-50 text-green-700 border border-green-200 rounded-full text-xs font-medium hover:bg-green-100 hover:border-green-300 transition-colors\",children:suggestion},idx))})]},m.id)),loading&&/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-start\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white border border-gray-200 rounded-2xl rounded-bl-md px-4 py-2 flex gap-1\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\",style:{animationDelay:'0ms'}}),/*#__PURE__*/_jsx(\"span\",{className:\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\",style:{animationDelay:'150ms'}}),/*#__PURE__*/_jsx(\"span\",{className:\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\",style:{animationDelay:'300ms'}})]})}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsx(\"div\",{className:\"p-3 border-t border-gray-200 bg-white\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:toggleVoice,className:\"p-2 rounded-xl transition-colors \".concat(listening?'bg-[#F6A500] text-white animate-pulse':'bg-gray-100 text-gray-600 hover:bg-gray-200'),\"aria-label\":listening?'Stop listening':'Start voice input',disabled:!('SpeechRecognition'in window||'webkitSpeechRecognition'in window),children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v7m0-9a7 7 0 017-7\"})})}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:input,onChange:e=>setInput(e.target.value),onKeyDown:handleKeyDown,placeholder:\"Ask about schemes...\",className:\"flex-1 px-4 py-2.5 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-[#1E8E4A] focus:border-transparent text-[#1F2937]\",\"aria-label\":\"Type your message\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>sendMessage(),disabled:loading||!input.trim(),className:\"px-4 py-2.5 bg-[#1E8E4A] text-white rounded-xl font-medium hover:bg-[#176B39] disabled:opacity-50 disabled:cursor-not-allowed transition-colors\",\"aria-label\":\"Send message\",children:\"Send\"})]})})]})]});};export default Chatbot;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}