{"ast":null,"code":"import _objectSpread from\"C:/Users/gmore/OneDrive/Desktop/Gaurav/krishi-ai/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";/**\r\n * Profile Wizard â€“ Multi-step form for farmer profile creation\r\n * Uses AuthContext for token and profile persistence\r\n */import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import{useTranslation}from'react-i18next';import{useAuth}from'../contexts/AuthContext';import VoiceInput from'../components/VoiceInput';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const STATES=['Maharashtra','Gujarat','Madhya Pradesh','Rajasthan','Karnataka','Andhra Pradesh','Telangana','Tamil Nadu','Uttar Pradesh','Punjab','Haryana','Bihar','West Bengal','Odisha','Chhattisgarh'];const CROPS=['rice','wheat','cotton','sugarcane','pulses','oilseeds','maize','soybean','vegetables','fruits','mango','banana'];const API_URL=process.env.REACT_APP_API_URL||'http://localhost:4001/api/v1';const ProfileWizard=()=>{const{t}=useTranslation();const navigate=useNavigate();const{token,isAuthenticated,user,setProfile:setAuthProfile}=useAuth();const[step,setStep]=useState(1);const[isSubmitting,setIsSubmitting]=useState(false);const[error,setError]=useState(null);const[success,setSuccess]=useState(false);const[profile,setProfile]=useState({name:'',mobile:(user===null||user===void 0?void 0:user.mobile)||'',state:'',district:'',village:'',landType:'irrigated',acreage:0,mainCrops:[],familyCount:1,annualIncome:0,farmerType:'owner'});// Redirect if not authenticated\nuseEffect(()=>{if(!isAuthenticated){navigate('/login');}},[isAuthenticated,navigate]);// Pre-fill mobile from auth\nuseEffect(()=>{if(user!==null&&user!==void 0&&user.mobile&&!profile.mobile){setProfile(prev=>_objectSpread(_objectSpread({},prev),{},{mobile:user.mobile}));}},[user,profile.mobile]);const updateProfile=(field,value)=>{setProfile(prev=>_objectSpread(_objectSpread({},prev),{},{[field]:value}));setError(null);};const handleVoiceResult=(text,field)=>{updateProfile(field,text);};const validateStep=()=>{if(step===1){if(!profile.name.trim()){setError('Name is required');return false;}if(!profile.state){setError('Please select a state');return false;}if(!profile.district.trim()){setError('District is required');return false;}}if(step===2){if(profile.acreage<=0){setError('Please enter land area');return false;}if(profile.mainCrops.length===0){setError('Select at least one crop');return false;}}if(step===3){if(profile.annualIncome<=0){setError('Please enter annual income');return false;}}return true;};const handleNext=()=>{if(!validateStep())return;if(step<3)setStep(step+1);};const handleBack=()=>{if(step>1)setStep(step-1);setError(null);};const handleSubmit=async()=>{if(!validateStep())return;setIsSubmitting(true);setError(null);try{// Map camelCase to snake_case for backend API\nconst apiBody={name:profile.name,mobile:profile.mobile||(user===null||user===void 0?void 0:user.mobile)||'0000000000',state:profile.state,district:profile.district,village:profile.village,land_type:profile.landType,acreage:profile.acreage,main_crops:profile.mainCrops,family_count:profile.familyCount,annual_income:profile.annualIncome,farmer_type:profile.farmerType};const response=await fetch(\"\".concat(API_URL,\"/profile\"),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify(apiBody)});if(!response.ok){const errData=await response.json().catch(()=>({}));throw new Error(errData.error||'Failed to save profile');}const data=await response.json();const savedProfile=data.profile;// Update AuthContext with the saved profile\nsetAuthProfile(savedProfile);setSuccess(true);// Navigate to schemes after a brief success animation\nsetTimeout(()=>{navigate('/schemes');},1500);}catch(err){console.error('Profile save failed:',err);setError(err.message||'Failed to save profile. Please try again.');}finally{setIsSubmitting(false);}};const handleCropToggle=crop=>{const crops=profile.mainCrops.includes(crop)?profile.mainCrops.filter(c=>c!==crop):[...profile.mainCrops,crop];updateProfile('mainCrops',crops);};if(success){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-[60vh] flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center animate-slide-up\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-20 h-20 mx-auto bg-green-100 rounded-full flex items-center justify-center text-4xl mb-6\",children:\"\\u2705\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 mb-2\",children:\"Profile Saved!\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Finding your best schemes...\"})]})});}const stepLabels=[{num:1,label:t('profile.step1')||'Personal Info',icon:'ðŸ‘¤'},{num:2,label:t('profile.step2')||'Farm Details',icon:'ðŸŒ¾'},{num:3,label:t('profile.step3')||'Family & Income',icon:'ðŸ’°'}];return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-2xl mx-auto px-4 py-8\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900 mb-2\",children:t('profile.title')||'Create Your Profile'}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 text-sm mb-6\",children:\"Fill your details to get personalized scheme recommendations\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center gap-2 mb-8\",children:stepLabels.map((s,i)=>/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>s.num<step&&setStep(s.num),disabled:s.num>step,className:\"flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium transition-all \".concat(s.num===step?'bg-green-100 text-green-700 ring-2 ring-green-500 ring-offset-2':s.num<step?'bg-green-500 text-white cursor-pointer hover:bg-green-600':'bg-gray-100 text-gray-400'),children:[/*#__PURE__*/_jsx(\"span\",{children:s.num<step?'âœ“':s.icon}),/*#__PURE__*/_jsx(\"span\",{className:\"hidden sm:inline\",children:s.label})]}),i<2&&/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 h-0.5 rounded \".concat(s.num<step?'bg-green-400':'bg-gray-200')})]},s.num))}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl mb-4 text-sm flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u26A0\\uFE0F\"}),\" \",error]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-lg border border-gray-100 p-6 md:p-8\",children:[step===1&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-5 animate-slide-up\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-semibold text-gray-700 mb-2\",children:[t('profile.name'),\" *\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:profile.name,onChange:e=>updateProfile('name',e.target.value),className:\"input-field flex-1\",placeholder:\"Enter your full name\",\"aria-label\":t('profile.name'),autoFocus:true}),/*#__PURE__*/_jsx(VoiceInput,{onResult:text=>handleVoiceResult(text,'name')})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-semibold text-gray-700 mb-2\",children:t('profile.mobile')}),/*#__PURE__*/_jsx(\"input\",{type:\"tel\",value:profile.mobile,onChange:e=>updateProfile('mobile',e.target.value),className:\"input-field bg-gray-50\",placeholder:\"9876543210\",maxLength:10,readOnly:!!(user!==null&&user!==void 0&&user.mobile),\"aria-label\":t('profile.mobile')})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-semibold text-gray-700 mb-2\",children:[t('profile.state'),\" *\"]}),/*#__PURE__*/_jsxs(\"select\",{value:profile.state,onChange:e=>updateProfile('state',e.target.value),className:\"select-field\",\"aria-label\":t('profile.state'),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select State\"}),STATES.map(state=>/*#__PURE__*/_jsx(\"option\",{value:state,children:state},state))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-semibold text-gray-700 mb-2\",children:[t('profile.district'),\" *\"]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:profile.district,onChange:e=>updateProfile('district',e.target.value),className:\"input-field\",placeholder:\"e.g. Pune\",\"aria-label\":t('profile.district')})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-semibold text-gray-700 mb-2\",children:t('profile.village')}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:profile.village,onChange:e=>updateProfile('village',e.target.value),className:\"input-field\",placeholder:\"Optional\",\"aria-label\":t('profile.village')})]})]})]}),step===2&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6 animate-slide-up\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-semibold text-gray-700 mb-3\",children:[t('profile.landType'),\" *\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-3 gap-3\",children:['irrigated','dry','mixed'].map(type=>/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:()=>updateProfile('landType',type),className:\"py-3 px-4 rounded-xl border-2 text-sm font-semibold transition-all \".concat(profile.landType===type?'border-green-500 bg-green-50 text-green-700 shadow-sm':'border-gray-200 hover:border-gray-300 hover:bg-gray-50'),children:[type==='irrigated'?'ðŸ’§':type==='dry'?'â˜€ï¸':'ðŸŒ¤ï¸',\" \",t(\"profile.\".concat(type))]},type))})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-semibold text-gray-700 mb-2\",children:[t('profile.acreage'),\" *\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:profile.acreage||'',onChange:e=>updateProfile('acreage',parseFloat(e.target.value)||0),className:\"input-field pr-20\",placeholder:\"1.5\",step:\"0.1\",min:\"0\",\"aria-label\":t('profile.acreage')}),/*#__PURE__*/_jsx(\"span\",{className:\"absolute right-4 top-1/2 -translate-y-1/2 text-sm text-gray-400\",children:\"hectares\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-semibold text-gray-700 mb-3\",children:[t('profile.crops'),\" * \",/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400 font-normal\",children:\"(select all that apply)\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-wrap gap-2\",children:CROPS.map(crop=>/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>handleCropToggle(crop),className:\"px-4 py-2 rounded-full text-sm font-medium transition-all \".concat(profile.mainCrops.includes(crop)?'bg-green-500 text-white shadow-sm scale-105':'bg-gray-100 text-gray-700 hover:bg-gray-200'),children:crop},crop))})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-semibold text-gray-700 mb-3\",children:[t('profile.farmerType'),\" *\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-3 gap-3\",children:['owner','tenant','sharecropper'].map(type=>/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>updateProfile('farmerType',type),className:\"py-3 px-4 rounded-xl border-2 text-sm font-semibold transition-all \".concat(profile.farmerType===type?'border-green-500 bg-green-50 text-green-700 shadow-sm':'border-gray-200 hover:border-gray-300 hover:bg-gray-50'),children:t(\"profile.\".concat(type))},type))})]})]}),step===3&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6 animate-slide-up\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-semibold text-gray-700 mb-2\",children:[t('profile.familyCount'),\" *\"]}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:profile.familyCount||'',onChange:e=>updateProfile('familyCount',parseInt(e.target.value)||1),className:\"input-field\",placeholder:\"4\",min:\"1\",\"aria-label\":t('profile.familyCount')})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-semibold text-gray-700 mb-2\",children:[t('profile.annualIncome'),\" *\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 font-medium\",children:\"\\u20B9\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:profile.annualIncome||'',onChange:e=>updateProfile('annualIncome',parseInt(e.target.value)||0),className:\"input-field pl-10\",placeholder:\"150000\",min:\"0\",step:\"1000\",\"aria-label\":t('profile.annualIncome')})]}),profile.annualIncome>0&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-green-600 mt-2 font-medium\",children:[\"\\u2248 \\u20B9\",(profile.annualIncome/12).toLocaleString('en-IN',{maximumFractionDigits:0}),\" per month\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4 border border-green-100\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-bold text-green-700 mb-3\",children:\"\\uD83D\\uDCCB Profile Summary\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-2 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"Name:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:profile.name})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"State:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:profile.state})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"Land:\"}),\" \",/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium\",children:[profile.acreage,\" ha (\",profile.landType,\")\"]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"Type:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium capitalize\",children:profile.farmerType})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-span-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"Crops:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:profile.mainCrops.join(', ')})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between mt-8 pt-6 border-t border-gray-100\",children:[step>1?/*#__PURE__*/_jsxs(\"button\",{onClick:handleBack,className:\"btn-secondary\",children:[\"\\u2190 \",t('profile.back')]}):/*#__PURE__*/_jsx(\"div\",{}),step<3?/*#__PURE__*/_jsxs(\"button\",{onClick:handleNext,className:\"btn-primary\",children:[t('profile.next'),\" \\u2192\"]}):/*#__PURE__*/_jsx(\"button\",{onClick:handleSubmit,disabled:isSubmitting,className:\"px-8 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white font-bold rounded-xl shadow-lg shadow-green-500/25 hover:shadow-xl disabled:opacity-50 transition-all duration-300 hover:-translate-y-0.5 disabled:hover:translate-y-0\",children:isSubmitting?/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsxs(\"svg\",{className:\"animate-spin h-5 w-5\",viewBox:\"0 0 24 24\",children:[/*#__PURE__*/_jsx(\"circle\",{className:\"opacity-25\",cx:\"12\",cy:\"12\",r:\"10\",stroke:\"currentColor\",strokeWidth:\"4\",fill:\"none\"}),/*#__PURE__*/_jsx(\"path\",{className:\"opacity-75\",fill:\"currentColor\",d:\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z\"})]}),\"Saving...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[t('profile.submit'),\" \\uD83D\\uDD0D\"]})})]})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-center text-sm text-gray-400 mt-6\",children:[\"\\uD83D\\uDD10 \",t('profile.privacyNote')]})]});};export default ProfileWizard;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}