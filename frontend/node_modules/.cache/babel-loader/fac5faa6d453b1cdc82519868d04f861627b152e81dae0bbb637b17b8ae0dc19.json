{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\gmore\\\\OneDrive\\\\Desktop\\\\Gaurav\\\\krishi-ai\\\\frontend\\\\src\\\\contexts\\\\OfflineContext.tsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n/**\r\n * Offline Context - Manages offline state and sync queue\r\n */\n\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { openDB } from 'idb';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst OfflineContext = /*#__PURE__*/createContext(undefined);\nlet db = null;\nasync function getDB() {\n  if (db) return db;\n  db = await openDB('krishi-ai-db', 1, {\n    upgrade(database) {\n      if (!database.objectStoreNames.contains('profiles')) {\n        database.createObjectStore('profiles', {\n          keyPath: 'id'\n        });\n      }\n      if (!database.objectStoreNames.contains('applications')) {\n        database.createObjectStore('applications', {\n          keyPath: 'id'\n        });\n      }\n      if (!database.objectStoreNames.contains('syncQueue')) {\n        database.createObjectStore('syncQueue', {\n          keyPath: 'id'\n        });\n      }\n    }\n  });\n  return db;\n}\nexport const OfflineProvider = ({\n  children\n}) => {\n  _s();\n  const [isOffline, setIsOffline] = useState(!navigator.onLine);\n  const [queuedCount, setQueuedCount] = useState(0);\n  useEffect(() => {\n    const handleOnline = () => setIsOffline(false);\n    const handleOffline = () => setIsOffline(true);\n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n\n    // Update queued count\n    updateQueuedCount();\n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, []);\n  const updateQueuedCount = async () => {\n    try {\n      const database = await getDB();\n      const count = await database.count('syncQueue');\n      setQueuedCount(count);\n    } catch {\n      console.error('Failed to get queue count');\n    }\n  };\n  const saveProfile = async (id, data) => {\n    const database = await getDB();\n    await database.put('profiles', {\n      id,\n      data,\n      synced: !isOffline,\n      updatedAt: new Date().toISOString()\n    });\n    if (isOffline) {\n      await database.put('syncQueue', {\n        id: `profile-${id}-${Date.now()}`,\n        type: 'profile',\n        operation: 'update',\n        data,\n        createdAt: new Date().toISOString()\n      });\n      updateQueuedCount();\n    }\n  };\n  const saveApplication = async (id, data) => {\n    const database = await getDB();\n    await database.put('applications', {\n      id,\n      data,\n      synced: !isOffline,\n      createdAt: new Date().toISOString()\n    });\n    if (isOffline) {\n      await database.put('syncQueue', {\n        id: `app-${id}-${Date.now()}`,\n        type: 'application',\n        operation: 'create',\n        data,\n        createdAt: new Date().toISOString()\n      });\n      updateQueuedCount();\n    }\n  };\n  const getProfile = async id => {\n    const database = await getDB();\n    const result = await database.get('profiles', id);\n    return (result === null || result === void 0 ? void 0 : result.data) || null;\n  };\n  const syncPending = async () => {\n    if (isOffline) return;\n    const database = await getDB();\n    const queue = await database.getAll('syncQueue');\n    for (const item of queue) {\n      try {\n        // In production, send to server\n        console.log('Syncing:', item);\n        await database.delete('syncQueue', item.id);\n      } catch (error) {\n        console.error('Sync failed for item:', item.id, error);\n      }\n    }\n    updateQueuedCount();\n  };\n\n  // Auto-sync when coming back online\n  useEffect(() => {\n    if (!isOffline) {\n      syncPending();\n    }\n  }, [isOffline]);\n  return /*#__PURE__*/_jsxDEV(OfflineContext.Provider, {\n    value: {\n      isOffline,\n      queuedCount,\n      saveProfile,\n      saveApplication,\n      getProfile,\n      syncPending\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 177,\n    columnNumber: 5\n  }, this);\n};\n_s(OfflineProvider, \"goKzLzUJn1plmv1V60ELvTn5Pf4=\");\n_c = OfflineProvider;\nexport const useOffline = () => {\n  _s2();\n  const context = useContext(OfflineContext);\n  if (context === undefined) {\n    throw new Error('useOffline must be used within an OfflineProvider');\n  }\n  return context;\n};\n_s2(useOffline, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nvar _c;\n$RefreshReg$(_c, \"OfflineProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","openDB","jsxDEV","_jsxDEV","OfflineContext","undefined","db","getDB","upgrade","database","objectStoreNames","contains","createObjectStore","keyPath","OfflineProvider","children","_s","isOffline","setIsOffline","navigator","onLine","queuedCount","setQueuedCount","handleOnline","handleOffline","window","addEventListener","updateQueuedCount","removeEventListener","count","console","error","saveProfile","id","data","put","synced","updatedAt","Date","toISOString","now","type","operation","createdAt","saveApplication","getProfile","result","get","syncPending","queue","getAll","item","log","delete","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useOffline","_s2","context","Error","$RefreshReg$"],"sources":["C:/Users/gmore/OneDrive/Desktop/Gaurav/krishi-ai/frontend/src/contexts/OfflineContext.tsx"],"sourcesContent":["/**\r\n * Offline Context - Manages offline state and sync queue\r\n */\r\n\r\nimport React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\r\nimport { openDB, DBSchema, IDBPDatabase } from 'idb';\r\n\r\ninterface KrishiDB extends DBSchema {\r\n  profiles: {\r\n    key: string;\r\n    value: {\r\n      id: string;\r\n      data: unknown;\r\n      synced: boolean;\r\n      updatedAt: string;\r\n    };\r\n  };\r\n  applications: {\r\n    key: string;\r\n    value: {\r\n      id: string;\r\n      data: unknown;\r\n      synced: boolean;\r\n      createdAt: string;\r\n    };\r\n  };\r\n  syncQueue: {\r\n    key: string;\r\n    value: {\r\n      id: string;\r\n      type: 'profile' | 'application';\r\n      operation: 'create' | 'update';\r\n      data: unknown;\r\n      createdAt: string;\r\n    };\r\n  };\r\n}\r\n\r\ninterface OfflineContextType {\r\n  isOffline: boolean;\r\n  queuedCount: number;\r\n  saveProfile: (id: string, data: unknown) => Promise<void>;\r\n  saveApplication: (id: string, data: unknown) => Promise<void>;\r\n  getProfile: (id: string) => Promise<unknown | null>;\r\n  syncPending: () => Promise<void>;\r\n}\r\n\r\nconst OfflineContext = createContext<OfflineContextType | undefined>(undefined);\r\n\r\nlet db: IDBPDatabase<KrishiDB> | null = null;\r\n\r\nasync function getDB(): Promise<IDBPDatabase<KrishiDB>> {\r\n  if (db) return db;\r\n  \r\n  db = await openDB<KrishiDB>('krishi-ai-db', 1, {\r\n    upgrade(database) {\r\n      if (!database.objectStoreNames.contains('profiles')) {\r\n        database.createObjectStore('profiles', { keyPath: 'id' });\r\n      }\r\n      if (!database.objectStoreNames.contains('applications')) {\r\n        database.createObjectStore('applications', { keyPath: 'id' });\r\n      }\r\n      if (!database.objectStoreNames.contains('syncQueue')) {\r\n        database.createObjectStore('syncQueue', { keyPath: 'id' });\r\n      }\r\n    }\r\n  });\r\n  \r\n  return db;\r\n}\r\n\r\nexport const OfflineProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\r\n  const [isOffline, setIsOffline] = useState(!navigator.onLine);\r\n  const [queuedCount, setQueuedCount] = useState(0);\r\n\r\n  useEffect(() => {\r\n    const handleOnline = () => setIsOffline(false);\r\n    const handleOffline = () => setIsOffline(true);\r\n\r\n    window.addEventListener('online', handleOnline);\r\n    window.addEventListener('offline', handleOffline);\r\n\r\n    // Update queued count\r\n    updateQueuedCount();\r\n\r\n    return () => {\r\n      window.removeEventListener('online', handleOnline);\r\n      window.removeEventListener('offline', handleOffline);\r\n    };\r\n  }, []);\r\n\r\n  const updateQueuedCount = async () => {\r\n    try {\r\n      const database = await getDB();\r\n      const count = await database.count('syncQueue');\r\n      setQueuedCount(count);\r\n    } catch {\r\n      console.error('Failed to get queue count');\r\n    }\r\n  };\r\n\r\n  const saveProfile = async (id: string, data: unknown) => {\r\n    const database = await getDB();\r\n    await database.put('profiles', {\r\n      id,\r\n      data,\r\n      synced: !isOffline,\r\n      updatedAt: new Date().toISOString()\r\n    });\r\n    \r\n    if (isOffline) {\r\n      await database.put('syncQueue', {\r\n        id: `profile-${id}-${Date.now()}`,\r\n        type: 'profile',\r\n        operation: 'update',\r\n        data,\r\n        createdAt: new Date().toISOString()\r\n      });\r\n      updateQueuedCount();\r\n    }\r\n  };\r\n\r\n  const saveApplication = async (id: string, data: unknown) => {\r\n    const database = await getDB();\r\n    await database.put('applications', {\r\n      id,\r\n      data,\r\n      synced: !isOffline,\r\n      createdAt: new Date().toISOString()\r\n    });\r\n    \r\n    if (isOffline) {\r\n      await database.put('syncQueue', {\r\n        id: `app-${id}-${Date.now()}`,\r\n        type: 'application',\r\n        operation: 'create',\r\n        data,\r\n        createdAt: new Date().toISOString()\r\n      });\r\n      updateQueuedCount();\r\n    }\r\n  };\r\n\r\n  const getProfile = async (id: string): Promise<unknown | null> => {\r\n    const database = await getDB();\r\n    const result = await database.get('profiles', id);\r\n    return result?.data || null;\r\n  };\r\n\r\n  const syncPending = async () => {\r\n    if (isOffline) return;\r\n    \r\n    const database = await getDB();\r\n    const queue = await database.getAll('syncQueue');\r\n    \r\n    for (const item of queue) {\r\n      try {\r\n        // In production, send to server\r\n        console.log('Syncing:', item);\r\n        await database.delete('syncQueue', item.id);\r\n      } catch (error) {\r\n        console.error('Sync failed for item:', item.id, error);\r\n      }\r\n    }\r\n    \r\n    updateQueuedCount();\r\n  };\r\n\r\n  // Auto-sync when coming back online\r\n  useEffect(() => {\r\n    if (!isOffline) {\r\n      syncPending();\r\n    }\r\n  }, [isOffline]);\r\n\r\n  return (\r\n    <OfflineContext.Provider value={{\r\n      isOffline,\r\n      queuedCount,\r\n      saveProfile,\r\n      saveApplication,\r\n      getProfile,\r\n      syncPending\r\n    }}>\r\n      {children}\r\n    </OfflineContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useOffline = () => {\r\n  const context = useContext(OfflineContext);\r\n  if (context === undefined) {\r\n    throw new Error('useOffline must be used within an OfflineProvider');\r\n  }\r\n  return context;\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}