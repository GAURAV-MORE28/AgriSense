{"ast":null,"code":"import React,{useState,useRef}from'react';import{useTranslation}from'react-i18next';import axios from'axios';import{useAuth}from'../contexts/AuthContext';import LoadingSpinner from'../components/LoadingSpinner';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_URL=process.env.REACT_APP_API_URL||'http://localhost:4001/api/v1';const DocumentUpload=()=>{const{t}=useTranslation();const fileInputRef=useRef(null);const{token}=useAuth();const[uploading,setUploading]=useState(false);const[documents,setDocuments]=useState([]);const[error,setError]=useState(null);const handleFileSelect=async e=>{const files=e.target.files;if(!(files!==null&&files!==void 0&&files.length))return;if(!token){setError(\"Please login to upload documents\");return;}setUploading(true);setError(null);const formData=new FormData();formData.append('file',files[0]);formData.append('doc_type_hint','aadhaar');// Hint for demo purposes\ntry{const res=await axios.post(\"\".concat(API_URL,\"/documents/upload\"),formData,{headers:{'Content-Type':'multipart/form-data','Authorization':\"Bearer \".concat(token)}});setDocuments(prev=>[...prev,res.data]);}catch(err){console.error('Upload failed',err);setError('Document upload failed. Please try again.');}finally{setUploading(false);if(fileInputRef.current)fileInputRef.current.value='';}};return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-2xl mx-auto px-4 py-8\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold mb-6\",children:t('documents.title')||'Document Upload'}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"p-4 mb-4 text-red-700 bg-red-100 rounded-lg\",children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow p-6 mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg mb-6\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-4xl mb-4 block\",children:\"\\uD83D\\uDCC4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mb-4\",children:t('documents.upload')||'Upload Aadhaar or Land Record'}),/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center gap-4\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>{var _fileInputRef$current;return(_fileInputRef$current=fileInputRef.current)===null||_fileInputRef$current===void 0?void 0:_fileInputRef$current.click();},className:\"btn-primary\",disabled:uploading,children:uploading?/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(LoadingSpinner,{size:\"sm\"}),\" Processing OCR...\"]}):t('documents.file')||'Select File'})}),/*#__PURE__*/_jsx(\"input\",{ref:fileInputRef,type:\"file\",accept:\"image/*,.pdf\",onChange:handleFileSelect,className:\"hidden\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-50 p-4 rounded-lg text-sm text-blue-800\",children:[\"\\u2139\\uFE0F \",/*#__PURE__*/_jsx(\"strong\",{children:\"Tip:\"}),\" Upload a clear image of your Aadhaar card or 7/12 extract. Our AI will automatically extract your details.\"]})]}),documents.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold mb-4\",children:\"Processed Documents\"}),documents.map((doc,idx)=>/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow p-4 border-l-4 border-green-500\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start mb-2\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-gray-900\",children:doc.filename}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-gray-500 uppercase\",children:doc.doc_type_guess})]}),/*#__PURE__*/_jsxs(\"span\",{className:\"bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full font-bold\",children:[\"OCR Confidence: \",(doc.ocr_confidence*100).toFixed(0),\"%\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 bg-gray-50 p-3 rounded\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mb-2 font-semibold uppercase\",children:\"Extracted Data:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-2 gap-2 text-sm\",children:Object.entries(doc.fields||{}).map(_ref=>{let[key,value]=_ref;return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-500 capitalize\",children:[key.replace('_',' '),\":\"]}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-1 font-medium text-gray-900 truncate block\",children:String(value)})]},key);})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-3 flex justify-end\",children:/*#__PURE__*/_jsx(\"button\",{className:\"text-primary-600 text-sm font-medium hover:underline\",children:\"Verify & Edit\"})})]},idx))]})]});};export default DocumentUpload;","map":{"version":3,"names":["React","useState","useRef","useTranslation","axios","useAuth","LoadingSpinner","jsx","_jsx","jsxs","_jsxs","API_URL","process","env","REACT_APP_API_URL","DocumentUpload","t","fileInputRef","token","uploading","setUploading","documents","setDocuments","error","setError","handleFileSelect","e","files","target","length","formData","FormData","append","res","post","concat","headers","prev","data","err","console","current","value","className","children","onClick","_fileInputRef$current","click","disabled","size","ref","type","accept","onChange","map","doc","idx","filename","doc_type_guess","ocr_confidence","toFixed","Object","entries","fields","_ref","key","replace","String"],"sources":["C:/Users/gmore/OneDrive/Desktop/Gaurav/krishi-ai/frontend/src/pages/DocumentUpload.tsx"],"sourcesContent":["import React, { useState, useRef } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport axios from 'axios';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport LoadingSpinner from '../components/LoadingSpinner';\r\n\r\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:4001/api/v1';\r\n\r\nconst DocumentUpload: React.FC = () => {\r\n  const { t } = useTranslation();\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const { token } = useAuth();\r\n\r\n  const [uploading, setUploading] = useState(false);\r\n  const [documents, setDocuments] = useState<Array<any>>([]);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const files = e.target.files;\r\n    if (!files?.length) return;\r\n\r\n    if (!token) {\r\n      setError(\"Please login to upload documents\");\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    setError(null);\r\n\r\n    const formData = new FormData();\r\n    formData.append('file', files[0]);\r\n    formData.append('doc_type_hint', 'aadhaar'); // Hint for demo purposes\r\n\r\n    try {\r\n      const res = await axios.post(`${API_URL}/documents/upload`, formData, {\r\n        headers: {\r\n          'Content-Type': 'multipart/form-data',\r\n          'Authorization': `Bearer ${token}`\r\n        }\r\n      });\r\n\r\n      setDocuments(prev => [...prev, res.data]);\r\n    } catch (err) {\r\n      console.error('Upload failed', err);\r\n      setError('Document upload failed. Please try again.');\r\n    } finally {\r\n      setUploading(false);\r\n      if (fileInputRef.current) fileInputRef.current.value = '';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-2xl mx-auto px-4 py-8\">\r\n      <h1 className=\"text-2xl font-bold mb-6\">{t('documents.title') || 'Document Upload'}</h1>\r\n\r\n      {error && (\r\n        <div className=\"p-4 mb-4 text-red-700 bg-red-100 rounded-lg\">\r\n          {error}\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"bg-white rounded-lg shadow p-6 mb-6\">\r\n        <div className=\"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg mb-6\">\r\n          <span className=\"text-4xl mb-4 block\">üìÑ</span>\r\n          <p className=\"text-gray-600 mb-4\">{t('documents.upload') || 'Upload Aadhaar or Land Record'}</p>\r\n\r\n          <div className=\"flex justify-center gap-4\">\r\n            <button\r\n              onClick={() => fileInputRef.current?.click()}\r\n              className=\"btn-primary\"\r\n              disabled={uploading}\r\n            >\r\n              {uploading ? (\r\n                <span className=\"flex items-center gap-2\">\r\n                  <LoadingSpinner size=\"sm\" /> Processing OCR...\r\n                </span>\r\n              ) : (\r\n                t('documents.file') || 'Select File'\r\n              )}\r\n            </button>\r\n          </div>\r\n\r\n          <input\r\n            ref={fileInputRef}\r\n            type=\"file\"\r\n            accept=\"image/*,.pdf\"\r\n            onChange={handleFileSelect}\r\n            className=\"hidden\"\r\n          />\r\n        </div>\r\n\r\n        <div className=\"bg-blue-50 p-4 rounded-lg text-sm text-blue-800\">\r\n          ‚ÑπÔ∏è <strong>Tip:</strong> Upload a clear image of your Aadhaar card or 7/12 extract.\r\n          Our AI will automatically extract your details.\r\n        </div>\r\n      </div>\r\n\r\n      {documents.length > 0 && (\r\n        <div className=\"space-y-4\">\r\n          <h2 className=\"text-lg font-semibold mb-4\">Processed Documents</h2>\r\n          {documents.map((doc, idx) => (\r\n            <div key={idx} className=\"bg-white rounded-lg shadow p-4 border-l-4 border-green-500\">\r\n              <div className=\"flex justify-between items-start mb-2\">\r\n                <div>\r\n                  <h3 className=\"font-semibold text-gray-900\">{doc.filename}</h3>\r\n                  <span className=\"text-xs text-gray-500 uppercase\">{doc.doc_type_guess}</span>\r\n                </div>\r\n                <span className=\"bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full font-bold\">\r\n                  OCR Confidence: {(doc.ocr_confidence * 100).toFixed(0)}%\r\n                </span>\r\n              </div>\r\n\r\n              <div className=\"mt-3 bg-gray-50 p-3 rounded\">\r\n                <p className=\"text-xs text-gray-500 mb-2 font-semibold uppercase\">Extracted Data:</p>\r\n                <div className=\"grid grid-cols-2 gap-2 text-sm\">\r\n                  {Object.entries(doc.fields || {}).map(([key, value]) => (\r\n                    <div key={key}>\r\n                      <span className=\"text-gray-500 capitalize\">{key.replace('_', ' ')}:</span>\r\n                      <span className=\"ml-1 font-medium text-gray-900 truncate block\">{String(value)}</span>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"mt-3 flex justify-end\">\r\n                <button className=\"text-primary-600 text-sm font-medium hover:underline\">\r\n                  Verify & Edit\r\n                </button>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DocumentUpload;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}